<?plantuml 1.2026.1beta5?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1043px" preserveAspectRatio="none" style="width:904px;height:1043px;background:#FFFFFF;" version="1.1" viewBox="0 0 904 1043" width="904px" zoomAndPan="magnify"><title>ACP Protocol - Prompt Turn Lifecycle</title><defs/><g><text fill="#000000" font-family="Verdana" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="457.5313" x="221.8135" y="35.4209">ACP Protocol - Prompt Turn Lifecycle</text><g><title>Agent</title><rect fill="#FFFFFF" height="817.6836" style="stroke:#000000;stroke-width:1;" width="10" x="513.9619" y="154.8711"/></g><g><title>LLM</title><rect fill="#FFFFFF" height="228.1953" style="stroke:#000000;stroke-width:1;" width="10" x="709.1563" y="224.8359"/></g><rect fill="#FFFFFF" height="141.9297" style="stroke:#000000;stroke-width:1;" width="724.1582" x="163" y="282.9688"/><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="C" id="part1-lifeline"><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="925.7813" width="8" x="206.2651" y="82.9063"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="210" x2="210" y1="82.9063" y2="1008.6875"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="A" id="part2-lifeline"><g><title>Agent</title><rect fill="#000000" fill-opacity="0.00000" height="925.7813" width="8" x="514.9619" y="82.9063"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="518.2422" x2="518.2422" y1="82.9063" y2="1008.6875"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="L" id="part3-lifeline"><g><title>LLM</title><rect fill="#000000" fill-opacity="0.00000" height="925.7813" width="8" x="710.1563" y="82.9063"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="713.3169" x2="713.3169" y1="82.9063" y2="1008.6875"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="C" id="part1-head"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="54.5303" x="183" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="190" y="71.6045">Client</text></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="C" id="part1-tail"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="54.5303" x="183" y="1007.6875"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="190" y="1027.6826">Client</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="A" id="part2-head"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="55.4395" x="491.2422" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="41.4395" x="498.2422" y="71.6045">Agent</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="A" id="part2-tail"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="55.4395" x="491.2422" y="1007.6875"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="41.4395" x="498.2422" y="1027.6826">Agent</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="L" id="part3-head"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="41.6787" x="693.3169" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="27.6787" x="700.3169" y="71.6045">LLM</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="L" id="part3-tail"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="41.6787" x="693.3169" y="1007.6875"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="27.6787" x="700.3169" y="1027.6826">LLM</text></g><g><title>Agent</title><rect fill="#FFFFFF" height="817.6836" style="stroke:#000000;stroke-width:1;" width="10" x="513.9619" y="154.8711"/></g><g><title>LLM</title><rect fill="#FFFFFF" height="228.1953" style="stroke:#000000;stroke-width:1;" width="10" x="709.1563" y="224.8359"/></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg1"><polygon fill="#000000" points="501.9619,150.8711,511.9619,154.8711,501.9619,158.8711,505.9619,154.8711" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="210.2651" x2="507.9619" y1="154.8711" y2="154.8711"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="100.0645" x="217.2651" y="149.8052">session/prompt</text></g><path d="M528,97.9063 L528,197.9063 L878,197.9063 L878,107.9063 L868,97.9063 L528,97.9063" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M868,97.9063 L868,107.9063 L878,107.9063 L868,97.9063" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="534" y="114.9731">{</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="179.7656" x="542.2646" y="130.106">"sessionId": "sess_abc123",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="73.106" x="542.2646" y="145.2388">"prompt": [</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="313.3394" x="550.5293" y="160.3716">{"type": "text", "text": "Fix the bug in auth.py"}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="542.2646" y="175.5044">]</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="534" y="190.6372">}</text><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg3"><polygon fill="#000000" points="697.1563,220.8359,707.1563,224.8359,697.1563,228.8359,701.1563,224.8359" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="523.9619" x2="703.1563" y1="224.8359" y2="224.8359"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="166.1943" x="530.9619" y="219.77">Submit prompt + context</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="892.1582" x="5" y="253.4023"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="897.1582" y1="253.4023" y2="253.4023"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="897.1582" y1="256.4023" y2="256.4023"/><rect fill="#FFFFFF" height="23.1328" style="stroke:#000000;stroke-width:1;" width="169.8032" x="366.1775" y="242.8359"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151.2773" x="372.1775" y="258.9028">Response Streaming</text><path d="M163,282.9688 L239.624,282.9688 L239.624,290.1016 L229.624,300.1016 L163,300.1016 L163,282.9688" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><rect fill="none" height="141.9297" style="stroke:#000000;stroke-width:1;" width="724.1582" x="163" y="282.9688"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31.624" x="178" y="296.0356">loop</text><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="115.6021" x="254.624" y="295.1792">[Response tokens]</text><g class="message" data-entity-1="part3" data-entity-2="part2" id="msg4"><polygon fill="#000000" points="534.9619,317.2344,524.9619,321.2344,534.9619,325.2344,530.9619,321.2344" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="528.9619" x2="708.1563" y1="321.2344" y2="321.2344"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="83.186" x="540.9619" y="316.1685">Token chunk</text></g><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg5"><polygon fill="#000000" points="221.2651,379.6328,211.2651,383.6328,221.2651,387.6328,217.2651,383.6328" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="215.2651" x2="512.9619" y1="383.6328" y2="383.6328"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="98.3062" x="227.2651" y="378.5669">session/update</text></g><path d="M528,334.2344 L528,419.2344 L876,419.2344 L876,344.2344 L866,334.2344 L528,334.2344" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M866,334.2344 L866,344.2344 L876,344.2344 L866,334.2344" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="534" y="351.3013">{</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="179.7656" x="542.2646" y="366.4341">"sessionId": "sess_abc123",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="318.9316" x="542.2646" y="381.5669">"sessionUpdate": "agent_message_text_update",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="139.7754" x="542.2646" y="396.6997">"text": "I'll analyze..."</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="534" y="411.8325">}</text><g class="message" data-entity-1="part3" data-entity-2="part2" id="msg7"><polygon fill="#000000" points="534.9619,449.0313,524.9619,453.0313,534.9619,457.0313,530.9619,453.0313" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="528.9619" x2="713.1563" y1="453.0313" y2="453.0313"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="107.7642" x="540.9619" y="447.9653">Tool call request</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="892.1582" x="5" y="481.5977"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="897.1582" y1="481.5977" y2="481.5977"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="897.1582" y1="484.5977" y2="484.5977"/><rect fill="#FFFFFF" height="23.1328" style="stroke:#000000;stroke-width:1;" width="126.1377" x="388.0103" y="471.0313"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107.6118" x="394.0103" y="487.0981">Tool Execution</text><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg8"><polygon fill="#000000" points="221.2651,569.6953,211.2651,573.6953,221.2651,577.6953,217.2651,573.6953" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="215.2651" x2="512.9619" y1="573.6953" y2="573.6953"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="279.6968" x="227.2651" y="568.6294">session/update (tool_call_update: pending)</text></g><path d="M528,509.1641 L528,624.1641 L794,624.1641 L794,519.1641 L784,509.1641 L528,509.1641" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M784,509.1641 L784,519.1641 L794,519.1641 L784,509.1641" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="534" y="526.231">{</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="237.5229" x="542.2646" y="541.3638">"sessionUpdate": "tool_call_update",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="141.0894" x="542.2646" y="556.4966">"toolCallId": "tc_001",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="169.0825" x="542.2646" y="571.6294">"title": "Reading auth.py",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="93.7549" x="542.2646" y="586.7622">"kind": "read",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="125.2202" x="542.2646" y="601.895">"status": "pending"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="534" y="617.0278">}</text><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg10"><polygon fill="#000000" points="221.2651,647.2266,211.2651,651.2266,221.2651,655.2266,217.2651,651.2266" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="215.2651" x2="512.9619" y1="651.2266" y2="651.2266"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="179.9243" x="227.2651" y="646.1606">session/request_permission</text></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg11"><polygon fill="#000000" points="501.9619,676.3594,511.9619,680.3594,501.9619,684.3594,505.9619,680.3594" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="210.2651" x2="507.9619" y1="680.3594" y2="680.3594"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="215.5854" x="217.2651" y="675.2935">PermissionResponse(allow_once)</text></g><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg12"><polygon fill="#000000" points="221.2651,705.4922,211.2651,709.4922,221.2651,713.4922,217.2651,709.4922" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="215.2651" x2="512.9619" y1="709.4922" y2="709.4922"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="236.082" x="227.2651" y="704.4263">session/update (status: in_progress)</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg13"><line style="stroke:#000000;stroke-width:1;" x1="523.9619" x2="565.9619" y1="738.625" y2="738.625"/><line style="stroke:#000000;stroke-width:1;" x1="565.9619" x2="565.9619" y1="738.625" y2="751.625"/><line style="stroke:#000000;stroke-width:1;" x1="524.9619" x2="565.9619" y1="751.625" y2="751.625"/><polygon fill="#000000" points="534.9619,747.625,524.9619,751.625,534.9619,755.625,530.9619,751.625" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="81.1357" x="530.9619" y="733.5591">Execute tool</text></g><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg14"><polygon fill="#000000" points="221.2651,776.7578,211.2651,780.7578,221.2651,784.7578,217.2651,780.7578" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="215.2651" x2="512.9619" y1="780.7578" y2="780.7578"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="230.0137" x="227.2651" y="775.6919">session/update (status: completed)</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="892.1582" x="5" y="809.3242"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="897.1582" y1="809.3242" y2="809.3242"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="897.1582" y1="812.3242" y2="812.3242"/><rect fill="#FFFFFF" height="23.1328" style="stroke:#000000;stroke-width:1;" width="154.7402" x="373.709" y="798.7578"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="136.2144" x="379.709" y="814.8247">Continue with LLM</text><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg15"><polygon fill="#000000" points="702.1563,849.0234,712.1563,853.0234,702.1563,857.0234,706.1563,853.0234" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="523.9619" x2="708.1563" y1="853.0234" y2="853.0234"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="68.6563" x="530.9619" y="847.9575">Tool result</text></g><g class="message" data-entity-1="part3" data-entity-2="part2" id="msg16"><polygon fill="#000000" points="534.9619,878.1563,524.9619,882.1563,534.9619,886.1563,530.9619,882.1563" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="528.9619" x2="713.1563" y1="882.1563" y2="882.1563"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="134.3164" x="540.9619" y="877.0903">Continue response...</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="892.1582" x="5" y="910.7227"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="897.1582" y1="910.7227" y2="910.7227"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="897.1582" y1="913.7227" y2="913.7227"/><rect fill="#FFFFFF" height="23.1328" style="stroke:#000000;stroke-width:1;" width="101.9785" x="400.0898" y="900.1563"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="83.4526" x="406.0898" y="916.2231">Completion</text><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg17"><polygon fill="#000000" points="221.2651,968.5547,211.2651,972.5547,221.2651,976.5547,217.2651,972.5547" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="215.2651" x2="517.9619" y1="972.5547" y2="972.5547"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="110.1699" x="227.2651" y="967.4888">PromptResponse</text></g><path d="M10,938.2891 L10,993.2891 L205,993.2891 L205,948.2891 L195,938.2891 L10,938.2891" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M195,938.2891 L195,948.2891 L205,948.2891 L195,938.2891" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="16" y="955.356">{</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="166.3784" x="24.2646" y="970.4888">"stopReason": "end_turn"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="16" y="985.6216">}</text><?plantuml-src XLJVQzim47xNNt7ponhMPEts5iZ0c0qA7eIsUoh3ACer4P4bpJwlpKh_zvqaEt4wsZrPkkz-VlTPxsYBDO8tKbiXI9D1o8ibB1j7JZa3qt2iFS5jrrWezJsglJ8eX9SDQQMzj0HPOJHQoa2sK9mY-MO0ybEWBBz7Sob40TClaCCSMcnRxUn77qiAwmYXqPijYIS1aFNmrJgRfqibL-hoq-ViFA0fYA4xlW4yPRJt63m97oaxxxzy_wOVWSU6LRS1RK5sj9tvVVRCOJ_5iq2xXb1PI4Nwj-GMSY7oq6B9BTvqgreJf6Bm0PIp8U_HcUTPBE0QM-ziYt133SfQsmqi5a8Ov_mH8xT3stBP4gOz0xV116hRsHtROzLYH4pdrro3aH4rF6eS-6rwZlYFc2FuoB2RgcOpdwemHfKA3143OrVlZG5ffTd_mTbibZ4Qs3emnGSXnaEmS9Jac0P_TTYIMECBVgBBrqTK7N5BaPjNXeKpOjygfEkxcuFdWapfv3M574Ty6Pka4gm56nDLfAgBYyiU2Nz0C5wZ32KEweZeJjiOmIjT9qjBahessFgUih62_fsf9wJosDGwceBwUzwM1-CWaJDkqZrKpYgSlC5GwcBEQgvOc9k6uKdo3caJpK5kplm_Xs9X6oHSJ-AY2jQtjXt2WwOjy4zxt5Kvh9hhTOP60ZW4DVqSB9e-Mqm-MddVJNfaXh7JNWtU3sibvtaXhRE1QQQt8dwDJgWUAIp_2m00?></g></svg>