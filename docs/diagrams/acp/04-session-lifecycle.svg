<?plantuml 1.2026.1beta5?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="STATE" height="1215px" preserveAspectRatio="none" style="width:1147px;height:1215px;background:#FFFFFF;" version="1.1" viewBox="0 0 1147 1215" width="1147px" zoomAndPan="magnify"><title>ACP Protocol - Session Lifecycle</title><defs/><g><g class="title" data-source-line="3"><text fill="#000000" font-family="Verdana" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="396.6875" x="370.9067" y="35.4209">ACP Protocol - Session Lifecycle</text></g><!--cluster Initializing--><g class="cluster" data-qualified-name="Initializing" data-source-line="7" id="ent0002"><path d="M223.92,148.6094 L358.92,148.6094 A12.5,12.5 0 0 1 371.42,161.1094 L371.42,169.9063 L211.42,169.9063 L211.42,161.1094 A12.5,12.5 0 0 1 223.92,148.6094" fill="#FFFFFF"/><path d="M211.42,169.9063 L371.42,169.9063 L371.42,461.1094 A12.5,12.5 0 0 1 358.92,473.6094 L223.92,473.6094 A12.5,12.5 0 0 1 211.42,461.1094 L211.42,169.9063" fill="#FFFFFF"/><rect fill="none" height="325" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="160" x="211.42" y="148.6094"/><line style="stroke:#000000;stroke-width:1;" x1="211.42" x2="371.42" y1="169.9063" y2="169.9063"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="71.627" x="255.6065" y="165.6045">Initializing</text></g><ellipse cx="287.42" cy="201.6094" fill="#FFFFFF" rx="10" ry="10" style="stroke:#000000;stroke-width:1;"/><g><rect fill="#FFFFFF" height="50" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="103.0156" x="235.91" y="272.6094"/><line style="stroke:#000000;stroke-width:1;" x1="235.91" x2="338.9256" y1="298.9063" y2="298.9063"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="83.0156" x="245.91" y="290.6045">AwaitingInit</text></g><g><rect fill="#FFFFFF" height="50" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="87.4775" x="235.68" y="399.6094"/><line style="stroke:#000000;stroke-width:1;" x1="235.68" x2="323.1575" y1="425.9063" y2="425.9063"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="67.4775" x="245.68" y="417.6045">Initialized</text></g><path d="M24.5,544.6094 L534.335,544.6094 A12.5,12.5 0 0 1 546.835,557.1094 L546.835,570.9063 L12,570.9063 L12,557.1094 A12.5,12.5 0 0 1 24.5,544.6094" fill="#FFFFFF"/><path d="M12,570.9063 L546.835,570.9063 L546.835,1098.4063 A12.5,12.5 0 0 1 534.335,1110.9063 L24.5,1110.9063 A12.5,12.5 0 0 1 12,1098.4063 L12,570.9063" fill="#FFFFFF"/><rect fill="none" height="566.2969" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="534.835" x="12" y="544.6094"/><line style="stroke:#000000;stroke-width:1;" x1="12" x2="546.835" y1="570.9063" y2="570.9063"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="96.9678" x="230.9336" y="562.6045">SessionActive</text><ellipse cx="214.5" cy="591.9063" fill="#FFFFFF" rx="10" ry="10" style="stroke:#000000;stroke-width:1;"/><g><rect fill="#FFFFFF" height="50" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="50" x="189.5" y="638.9063"/><line style="stroke:#000000;stroke-width:1;" x1="189.5" x2="239.5" y1="665.2031" y2="665.2031"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="25.5186" x="201.7407" y="656.9014">Idle</text></g><g><rect fill="#FFFFFF" height="50" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="95.3115" x="39.85" y="741.9063"/><line style="stroke:#000000;stroke-width:1;" x1="39.85" x2="135.1615" y1="768.2031" y2="768.2031"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="75.3115" x="49.85" y="759.9014">Processing</text></g><g><rect fill="#FFFFFF" height="50" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="92.6113" x="129.2" y="844.9063"/><line style="stroke:#000000;stroke-width:1;" x1="129.2" x2="221.8113" y1="871.2031" y2="871.2031"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="72.6113" x="139.2" y="862.9014">Streaming</text></g><g><rect fill="#FFFFFF" height="50" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="89.4531" x="266.78" y="947.9063"/><line style="stroke:#000000;stroke-width:1;" x1="266.78" x2="356.2331" y1="974.2031" y2="974.2031"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="69.4531" x="276.78" y="965.9014">Executing</text></g><g><rect fill="#FFFFFF" height="50" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="88.8174" x="159.09" y="1050.9063"/><line style="stroke:#000000;stroke-width:1;" x1="159.09" x2="247.9074" y1="1077.2031" y2="1077.2031"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="68.8174" x="169.09" y="1068.9014">Cancelled</text></g><!--link *start*SessionActive to Idle--><g class="link" data-entity-1="ent0010" data-entity-2="ent0011" data-link-type="dependency" data-source-line="15" id="lnk12"><path d="M214.5,602.3463 C214.5,611.6063 214.5,620.0963 214.5,632.5863" fill="none" id="*start*SessionActive-to-Idle" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="214.5,638.5863,218.5,629.5863,214.5,633.5863,210.5,629.5863,214.5,638.5863" style="stroke:#000000;stroke-width:1;"/></g><!--link Idle to Processing--><g class="link" data-entity-1="ent0011" data-entity-2="ent0013" data-link-type="dependency" data-source-line="17" id="lnk14"><path d="M189.25,665.2462 C159.65,667.1463 111.69,675.3063 88.5,706.9063 C81.35,716.6563 79.9322,723.9813 81.1822,735.4913" fill="none" id="Idle-to-Processing" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="81.83,741.4563,84.8349,732.077,81.2902,736.4855,76.8817,732.9407,81.83,741.4563" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="110.208" x="89.5" y="719.9731">session/prompt()</text></g><!--link Processing to Streaming--><g class="link" data-entity-1="ent0013" data-entity-2="ent0015" data-link-type="dependency" data-source-line="18" id="lnk16"><path d="M86.36,792.1663 C86.97,803.6163 89.43,816.9363 96.5,826.9063 C104.5,838.1863 111.147,843.9469 123.387,850.2569" fill="none" id="Processing-to-Streaming" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="128.72,853.0063,122.5533,845.3269,124.2758,850.7152,118.8876,852.4377,128.72,853.0063" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="102.7495" x="97.5" y="822.9731">LLM responding</text></g><!--link Streaming to Executing--><g class="link" data-entity-1="ent0015" data-entity-2="ent0017" data-link-type="dependency" data-source-line="19" id="lnk18"><path d="M169.49,895.3563 C168.11,906.9963 168.86,920.4063 176.5,929.9063 C198.26,956.9463 219.44,937.3363 252.5,947.9063 C257.03,949.3563 256.0741,948.9108 260.7141,950.6308" fill="none" id="Streaming-to-Executing" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="266.34,952.7163,259.2914,945.8374,261.6517,950.9784,256.5108,953.3387,266.34,952.7163" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="60.7026" x="177.5" y="925.9731">Tool calls</text></g><!--link Executing to Streaming--><g class="link" data-entity-1="ent0017" data-entity-2="ent0015" data-link-type="dependency" data-source-line="20" id="lnk19"><path d="M282.5,947.4563 C269.3,936.5863 253.34,923.8163 238.5,912.9063 C230.45,906.9863 226.6114,904.2308 218.1814,898.5708" fill="none" id="Executing-to-Streaming" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="213.2,895.2262,218.4424,903.564,217.3511,898.0134,222.9017,896.9222,213.2,895.2262" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="109.3574" x="259.5" y="925.9731">More LLM output</text></g><!--link Streaming to Idle--><g class="link" data-entity-1="ent0015" data-entity-2="ent0011" data-link-type="dependency" data-source-line="21" id="lnk20"><path d="M192.52,844.4663 C195.68,838.9163 198.58,832.8863 200.5,826.9063 C215.65,779.8863 216.7973,727.4439 215.8973,695.1739" fill="none" id="Streaming-to-Idle" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="215.73,689.1763,211.9825,698.2843,215.8694,694.1743,219.9794,698.0612,215.73,689.1763" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="110.1699" x="215.5" y="771.4731">PromptResponse</text></g><!--link Processing to Cancelled--><g class="link" data-entity-1="ent0013" data-entity-2="ent0021" data-link-type="dependency" data-source-line="23" id="lnk22"><path d="M70.92,792.2763 C51.09,824.6463 23,883.2063 43.5,929.9063 C67.08,983.6263 116.5677,1022.6356 155.4077,1047.3456" fill="none" id="Processing-to-Cancelled" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="160.47,1050.5662,155.0236,1042.3604,156.2514,1047.8824,150.7294,1049.1102,160.47,1050.5662" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="104.7554" x="44.5" y="925.9731">session/cancel()</text></g><!--link Streaming to Cancelled--><g class="link" data-entity-1="ent0015" data-entity-2="ent0021" data-link-type="dependency" data-source-line="24" id="lnk23"><path d="M164.06,895.1663 C153.46,921.0063 140.8,962.9363 151.5,997.9063 C157.45,1017.3463 166.4003,1031.6043 177.7503,1045.8443" fill="none" id="Streaming-to-Cancelled" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="181.49,1050.5363,179.0084,1041.0052,178.3736,1046.6263,172.7524,1045.9915,181.49,1050.5363" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="104.7554" x="152.5" y="977.4731">session/cancel()</text></g><!--link Executing to Cancelled--><g class="link" data-entity-1="ent0017" data-entity-2="ent0021" data-link-type="dependency" data-source-line="25" id="lnk24"><path d="M285.32,998.3263 C279.15,1004.0863 272.59,1010.2163 266.5,1015.9063 C254.35,1027.2663 245.2675,1035.7629 233.9275,1046.3929" fill="none" id="Executing-to-Cancelled" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="229.55,1050.4963,238.8518,1047.2595,233.1979,1047.0768,233.3806,1041.4229,229.55,1050.4963" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="104.7554" x="267.5" y="1028.9731">session/cancel()</text></g><!--link Cancelled to Idle--><g class="link" data-entity-1="ent0021" data-entity-2="ent0011" data-link-type="dependency" data-source-line="26" id="lnk25"><path d="M248.16,1069.1163 C292.18,1062.5063 355.28,1050.3162 372.5,1032.9063 C391.46,1013.7463 386.5,1000.8563 386.5,973.9063 C386.5,765.9063 386.5,765.9063 386.5,765.9063 C386.5,698.7262 293.6599,676.2808 245.8099,668.9008" fill="none" id="Cancelled-to-Idle" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="239.88,667.9862,248.1651,673.3114,244.8216,668.7484,249.3845,665.4049,239.88,667.9862" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="149.335" x="387.5" y="874.4731">stop_reason: cancelled</text></g><ellipse cx="363.42" cy="67.6094" fill="#FFFFFF" rx="10" ry="10" style="stroke:#000000;stroke-width:1;"/><ellipse cx="279.42" cy="1198.9094" fill="none" rx="11" ry="11" style="stroke:#000000;stroke-width:1;"/><ellipse cx="279.42" cy="1198.9094" fill="#FFFFFF" rx="6" ry="6" style="stroke:#000000;stroke-width:1;"/><g class="entity" data-qualified-name="GMN2" data-source-line="33" id="ent0003"><path d="M896.33,807.6294 L896.33,823.7594 L547.16,827.7594 L896.33,831.7594 L896.33,847.895 A0,0 0 0 0 896.33,847.895 L1140.5009,847.895 A0,0 0 0 0 1140.5009,847.895 L1140.5009,817.6294 L1130.5009,807.6294 L896.33,807.6294 A0,0 0 0 0 896.33,807.6294" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M1130.5009,807.6294 L1130.5009,817.6294 L1140.5009,817.6294 L1130.5009,807.6294" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="223.1709" x="902.33" y="824.6963">Session persists between prompts</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="214.8872" x="902.33" y="839.8291">Can be resumed via session/load</text></g><!--link *start* to Initializing--><g class="link" data-entity-1="ent0002" data-entity-2="ent0002" data-link-type="dependency" data-source-line="5" id="lnk3"><path d="M363.42,78.1094 C363.42,85.5569 363.42,96.7581 363.42,109.4145 C363.42,115.7427 363.42,122.4347 363.42,129.2032 C363.42,132.5874 363.42,135.9908 363.42,139.3773 C363.42,141.0706 363.42,142.7596 363.42,144.44 C363.42,145.2802 363.42,146.1182 363.42,146.9535 C363.42,147.3712 363.42,141.7881 363.42,142.2043" fill="none" id="*start*-to-Initializing" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="363.42,148.2043,367.42,139.2043,363.42,143.2043,359.42,139.2043,363.42,148.2043" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="89.1401" x="364.42" y="120.6763">Agent started</text></g><!--link *start*Initializing to AwaitingInit--><g class="link" data-entity-1="ent0004" data-entity-2="ent0005" data-link-type="dependency" data-source-line="8" id="lnk6"><path d="M287.42,211.9694 C287.42,225.8994 287.42,246.5694 287.42,266.2594" fill="none" id="*start*Initializing-to-AwaitingInit" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="287.42,272.2594,291.42,263.2594,287.42,267.2594,283.42,263.2594,287.42,272.2594" style="stroke:#000000;stroke-width:1;"/></g><!--link AwaitingInit to Initialized--><g class="link" data-entity-1="ent0005" data-entity-2="ent0007" data-link-type="dependency" data-source-line="9" id="lnk8"><path d="M285.86,323.0094 C284.45,345.0394 282.7609,371.2815 281.3609,393.2915" fill="none" id="AwaitingInit-to-Initialized" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="280.98,399.2794,285.5432,390.5514,281.2974,394.2895,277.5594,390.0436,280.98,399.2794" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="64.3271" x="285.42" y="365.6763">initialize()</text></g><!--link Initialized to SessionActive--><g class="link" data-entity-1="ent0007" data-entity-2="ent0003" data-link-type="dependency" data-source-line="12" id="lnk9"><path d="M279.42,450.0994 C279.42,471.6194 279.42,499.4994 279.42,538.3194" fill="none" id="Initialized-to-SessionActive" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="279.42,544.3194,283.42,535.3194,279.42,539.3194,275.42,535.3194,279.42,544.3194" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="89.5146" x="280.42" y="510.6763">session/new()</text></g><!--link SessionActive to SessionActive--><g class="link" data-entity-1="ent0003" data-entity-2="ent0003" data-link-type="dependency" data-source-line="29" id="lnk26"><path d="M547.31,804.7994 C568.64,809.8194 581.83,817.4694 581.83,827.7594 C581.83,838.0494 574.4798,844.3222 553.1498,849.3522" fill="none" id="SessionActive-to-SessionActive" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="547.31,850.7294,556.9878,852.5569,552.1765,849.5818,555.1516,844.7705,547.31,850.7294" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="125.8804" x="587.83" y="832.3263">session/set_mode()</text></g><!--link SessionActive to SessionActive--><g class="link" data-entity-1="ent0003" data-entity-2="ent0003" data-link-type="dependency" data-source-line="30" id="lnk27"><path d="M547.18,767.4794 C640.42,768.2894 718.83,788.3794 718.83,827.7594 C718.83,867.1394 646.4198,887.1873 553.1798,887.9973" fill="none" id="SessionActive-to-SessionActive-1" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="547.18,888.0494,556.2144,891.971,552.1798,888.0059,556.1449,883.9713,547.18,888.0494" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="129.4922" x="724.83" y="832.3263">session/set_model()</text></g><!--link SessionActive to *end*--><g class="link" data-entity-1="ent0003" data-entity-2="ent0028" data-link-type="dependency" data-source-line="37" id="lnk29"><path d="M279.42,1111.3594 C279.42,1145.3794 279.42,1167.1394 279.42,1181.4294" fill="none" id="SessionActive-to-*end*" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="279.42,1187.4294,283.42,1178.4294,279.42,1182.4294,275.42,1178.4294,279.42,1187.4294" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="126.2295" x="280.42" y="1153.9763">Process terminated</text></g><?plantuml-src bL9DQyCm3BtxLsYtRL1sps4GoWw55igssnZ5izNKuDZ1LjfziFy-sMdQf1ihFIMMdfxUatH56wmH6YkD4u8CMOHokeHbyEILjp219upHU0TpiqRreImAyNBx2fF9FSoS8IEj-JIkWWBA2Xr191a8jH3yGpZ6V0c0lhZSISwuAW4uF7oEoL4pjpcyhc_4jn33R4BlLPQAp1OP7xltdSCT5-orZ453CJETV47-vW0FG2LqDjQJDS7N3J4V3FEvFGMKTOUUpnSGC3RUQGumzfXCq8TtL2rrq6VF8rRIsiYmO-AKSU43PbhVKjFIBygikaYQMDvZRXspdHELK-aKMfi7sdjIEPOzZKdFWCTgpu2FwO7SIBvPSSVeNG6gHwJbZlVqtteZqghsEXt5vKL9ct2U3oEOQaFWr-EID9BzyJSOeeaKuGrfXyY1FElOUUDesdXRiy6jaOT6raijq6b8JVwobSwlwBS4X86dpuUgVm00?></g></svg>